# Структура контекстов бота

## Обзор

Бот использует несколько источников информации, организованных по принципу разделения ответственности:

1. **System Prompt** - манера поведения и стиль общения
2. **Static Context** - миссия компании и общая информация
3. **Dynamic Context** - актуальные цены, тарифы и сроки
4. **Knowledge Cards** - структурированные факты по темам
5. **FAQ** - проверенные вопросы и ответы

## Файлы и их назначение

### `data/system_prompt.txt`
**Назначение:** Определяет КАК бот должен общаться

**Содержит:**
- Характеристики личности бота
- Стиль общения
- Правила взаимодействия с клиентами
- Манеру поведения

**Что НЕ должно быть здесь:**
- Факты о компании
- Цены и тарифы
- Описание услуг (это в static_context)

**Когда обновлять:** Редко, только при изменении стиля общения

---

### `data/static_context.txt`
**Назначение:** Миссия компании и общая информация об услугах

**Содержит:**
- Миссию компании
- Описание предоставляемых услуг
- Особенности работы компании
- Общую информацию, которая не меняется часто

**Что НЕ должно быть здесь:**
- Актуальные цены и тарифы (это в dynamic_context)
- Сроки подачи (это в dynamic_context)
- Манера поведения (это в system_prompt)

**Когда обновлять:** При изменении миссии, добавлении новых услуг, изменении позиционирования

---

### `data/dynamic_context.txt`
**Назначение:** Актуальная информация, которая меняется регулярно

**Содержит:**
- Актуальные цены и тарифы
- Сроки подачи документов
- Доступность записей
- Процент одобрения виз
- Условия оплаты и возврата
- Финансовые рекомендации
- Особые условия

**Приоритет:** Имеет приоритет над другими источниками для цен и сроков

**Когда обновлять:** Регулярно (еженедельно или при изменении цен/сроков)

---

### `data/knowledge_cards.json`
**Назначение:** Структурированная база знаний по темам

**Содержит:**
- Тематические карточки с фактами
- Информация, извлеченная из истории диалогов
- Структурированные данные по странам, услугам и т.д.

**Приоритет:** Главный источник знаний при поиске информации

**Когда обновлять:** Автоматически (из истории диалогов) или вручную через админ-панель

---

### `data/faq.json`
**Назначение:** Проверенные вопросы и ответы от менеджеров

**Содержит:**
- Кураторские Q/A пары
- Только записи с source="admin" или source="manager"

**Когда обновлять:** Через админ-панель при добавлении новых проверенных ответов

---

## Иерархия приоритетов источников

При формировании ответа бот использует источники в следующем порядке приоритета:

1. **Knowledge Cards** - главный источник знаний для фактов
2. **Dynamic Context** - приоритет для цен, тарифов и сроков
3. **Static Context** - общая информация о компании и услугах
4. **FAQ** - проверенные ответы от менеджеров
5. **Dialogue Context** - контекст текущего диалога

## Правила работы с контекстами

### При противоречиях:
- Для **цен и сроков** - приоритет у Dynamic Context
- Для **фактов** - приоритет у Knowledge Cards
- Если информации недостаточно - бот передает диалог менеджеру

### При обновлении:
- **Dynamic Context** обновляется регулярно (цены, сроки)
- **Static Context** обновляется редко (миссия, услуги)
- **System Prompt** обновляется очень редко (стиль общения)
- **Knowledge Cards** обновляются автоматически или вручную

## Примеры использования

### Пример 1: Вопрос о цене
- Бот использует **Dynamic Context** для актуальной цены
- Если в Dynamic Context нет - использует **Knowledge Cards**
- Если нет нигде - передает менеджеру

### Пример 2: Вопрос о миссии компании
- Бот использует **Static Context**
- Может дополнить информацией из **Knowledge Cards**

### Пример 3: Вопрос о конкретной стране
- Бот использует **Knowledge Cards** (структурированные факты)
- Дополняет актуальными данными из **Dynamic Context** (сроки, цены)
- Использует **FAQ** если есть похожий вопрос

## Рекомендации по заполнению

### Static Context должен быть:
- Кратким и структурированным
- Сфокусированным на миссии и услугах
- Без конкретных цен и сроков

### Dynamic Context должен быть:
- Актуальным (обновляться регулярно)
- Структурированным по разделам
- С четкими заголовками для быстрого поиска

### System Prompt должен быть:
- Сфокусированным на стиле общения
- Без фактов о компании
- С четкими правилами поведения

