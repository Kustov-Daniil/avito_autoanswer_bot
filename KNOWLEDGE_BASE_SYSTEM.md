# –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π

## –û–±–∑–æ—Ä

–£–ª—É—á—à–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π (knowledge cards) —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ–º –∑–Ω–∞–Ω–∏–π –∏–∑ –ø–µ—Ä–µ–ø–∏—Å–æ–∫ –∏ —Ä—É—á–Ω—ã–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∞–¥–º–∏–Ω–æ–º.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Knowledge Cards

### –§–æ—Ä–º–∞—Ç –∫–∞—Ä—Ç–æ—á–∫–∏

```json
{
  "topic": "–í–∏–∑–∞ –≤ –ò—Ç–∞–ª–∏—é",
  "category": "–≤–∏–∑—ã_—à–µ–Ω–≥–µ–Ω",
  "facts": [
    "–°—Ä–æ–∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è: 60 –¥–Ω–µ–π",
    "–°—Ç–æ–∏–º–æ—Å—Ç—å: –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∏–ø–∞ –≤–∏–∑—ã"
  ],
  "tags": ["–∏—Ç–∞–ª–∏—è", "—à–µ–Ω–≥–µ–Ω", "–≤–∏–∑–∞"],
  "priority": 1,
  "relevance_score": 0.95,
  "source": "llm_extraction",
  "dialog_ids": ["avito_u2u-..."],
  "usage_count": 5,
  "created_at": "2025-12-12T13:06:35.939878",
  "updated_at": "2025-12-12T15:02:44.047139",
  "last_used_at": "2025-12-12T15:02:44.047139"
}
```

### –ü–æ–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏

- **topic** - –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- **category** - –ö–∞—Ç–µ–≥–æ—Ä–∏—è –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ (—Å–º. —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–∏–∂–µ)
- **facts** - –°–ø–∏—Å–æ–∫ —Ñ–∞–∫—Ç–æ–≤ –ø–æ —Ç–µ–º–µ
- **tags** - –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞
- **priority** - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç (1-–≤—ã—Å–æ–∫–∏–π, 2-—Å—Ä–µ–¥–Ω–∏–π, 3-–Ω–∏–∑–∫–∏–π)
- **relevance_score** - –û—Ü–µ–Ω–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ (0-1), –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏
- **source** - –ò—Å—Ç–æ—á–Ω–∏–∫: "history_learning", "admin_manual", "llm_extraction"
- **dialog_ids** - ID –¥–∏–∞–ª–æ–≥–æ–≤, –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –∏–∑–≤–ª–µ—á–µ–Ω—ã –∑–Ω–∞–Ω–∏—è
- **usage_count** - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π
- **created_at** - –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
- **updated_at** - –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- **last_used_at** - –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏

- `–≤–∏–∑—ã_—à–µ–Ω–≥–µ–Ω` - –í–∏–∑—ã –≤ —Å—Ç—Ä–∞–Ω—ã –®–µ–Ω–≥–µ–Ω—Å–∫–æ–π –∑–æ–Ω—ã
- `–≤–∏–∑—ã_–¥—Ä—É–≥–∏–µ` - –í–∏–∑—ã –≤ –¥—Ä—É–≥–∏–µ —Å—Ç—Ä–∞–Ω—ã
- `–¥–æ–∫—É–º–µ–Ω—Ç—ã` - –î–æ–∫—É–º–µ–Ω—Ç—ã –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- `—Å—Ç–æ–∏–º–æ—Å—Ç—å` - –°—Ç–æ–∏–º–æ—Å—Ç—å –∏ –æ–ø–ª–∞—Ç–∞
- `—Å—Ä–æ–∫–∏` - –°—Ä–æ–∫–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∏ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏—è
- `–ø—Ä–æ—Ü–µ—Å—Å` - –ü—Ä–æ—Ü–µ—Å—Å –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è
- `–æ—Å–æ–±—ã–µ_—É—Å–ª–æ–≤–∏—è` - –û—Å–æ–±—ã–µ —É—Å–ª–æ–≤–∏—è –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- `–æ–±—â–µ–µ` - –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

## –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∑–Ω–∞–Ω–∏–π –∏–∑ –ø–µ—Ä–µ–ø–∏—Å–æ–∫

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏ –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞–Ω–∏—è —á–µ—Ä–µ–∑ LLM.

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –¥–∏–∞–ª–æ–≥–∏ —Å—Ç–∞—Ä—à–µ `MIN_DIALOG_AGE_MINUTES` –º–∏–Ω—É—Ç
2. LLM –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–µ–º—ã, —Ñ–∞–∫—Ç—ã, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Ç–µ–≥–∏ –∏–∑ –¥–∏–∞–ª–æ–≥–∞
3. –ó–Ω–∞–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ knowledge cards
4. –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –∏–∑ —Ç–æ–≥–æ –∂–µ –¥–∏–∞–ª–æ–≥–∞ - –∑–Ω–∞–Ω–∏—è –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è

**–ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ –±–æ—Ç–∞:**
- –ö–æ–º–∞–Ω–¥–∞: `/faq` ‚Üí "üõ† –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏" ‚Üí "ü§ñ –ò–∑–≤–ª–µ—á—å –∑–Ω–∞–Ω–∏—è –∏–∑ –ø–µ—Ä–µ–ø–∏—Å–æ–∫"

**–ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π –∑–∞–ø—É—Å–∫:**
```python
from utils.knowledge_extractor import process_dialogs_for_knowledge_extraction

stats = await process_dialogs_for_knowledge_extraction(
    max_dialogs=50,  # –ú–∞–∫—Å–∏–º—É–º –¥–∏–∞–ª–æ–≥–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
    min_age_minutes=5  # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç –¥–∏–∞–ª–æ–≥–∞
)
```

### 2. –†—É—á–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–Ω–∞–Ω–∏–π –∞–¥–º–∏–Ω–æ–º

–ê–¥–º–∏–Ω –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –∑–Ω–∞–Ω–∏—è –∏–∑ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞. –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–≤–ª–µ—á–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞–Ω–∏—è.

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –ê–¥–º–∏–Ω –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç (–º–æ–∂–Ω–æ —á–∞—Å—Ç—è–º–∏)
2. –ë–æ—Ç –ø–∞—Ä—Å–∏—Ç —Ç–µ–∫—Å—Ç –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–µ–º—ã –∏ —Ñ–∞–∫—Ç—ã
3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Ç–µ–≥–∏
4. –ó–Ω–∞–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±–∞–∑—É

**–ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ –±–æ—Ç–∞:**
- –ö–æ–º–∞–Ω–¥–∞: `/knowledge` –∏–ª–∏ `/kb` ‚Üí "üìù –î–æ–±–∞–≤–∏—Ç—å –∑–Ω–∞–Ω–∏—è (—Ç–µ–∫—Å—Ç–æ–º)"

### 3. –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ —Å –ø–µ—Ä–µ–ø–∏—Å–∫–∞–º–∏

–ê–¥–º–∏–Ω –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å –±–æ–ª—å—à–æ–π —Ñ–∞–π–ª —Å –ø–µ—Ä–µ–ø–∏—Å–∫–∞–º–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∑–Ω–∞–Ω–∏–π.

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:**
- **JSON** - –º–∞—Å—Å–∏–≤ –¥–∏–∞–ª–æ–≥–æ–≤ –∏–ª–∏ –æ–±—ä–µ–∫—Ç–æ–≤ —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
- **TXT** - —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø–µ—Ä–µ–ø–∏—Å–∫–∏ (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ - —Å–æ–æ–±—â–µ–Ω–∏–µ)
- **CSV** - —Ç–∞–±–ª–∏—Ü–∞ —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏ (—Å–æ–æ–±—â–µ–Ω–∏–µ, —Ä–æ–ª—å, –¥–∞—Ç–∞ –∏ —Ç.–¥.)
- **HTML** - HTML —Ñ–∞–π–ª—ã —Å –ø–µ—Ä–µ–ø–∏—Å–∫–∞–º–∏

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –ê–¥–º–∏–Ω –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–∞–π–ª —á–µ—Ä–µ–∑ –±–æ—Ç–∞
2. –ë–æ—Ç –ø–∞—Ä—Å–∏—Ç —Ñ–∞–π–ª –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∏–∞–ª–æ–≥–∏
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞ LLM –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∑–Ω–∞–Ω–∏—è
4. –í—Å–µ –∑–Ω–∞–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±–∞–∑—É

**–ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ –±–æ—Ç–∞:**
- –ö–æ–º–∞–Ω–¥–∞: `/knowledge` –∏–ª–∏ `/kb` ‚Üí "üìé –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª —Å –ø–µ—Ä–µ–ø–∏—Å–∫–∞–º–∏"

**–ü—Ä–∏–º–µ—Ä—ã —Ñ–æ—Ä–º–∞—Ç–æ–≤:**

JSON:
```json
[
  {
    "messages": [
      {"role": "user", "content": "–°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç –≤–∏–∑–∞?"},
      {"role": "assistant", "content": "–°—Ç–æ–∏–º–æ—Å—Ç—å –≤–∏–∑—ã –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å—Ç—Ä–∞–Ω—ã..."}
    ]
  }
]
```

TXT:
```
–ö–ª–∏–µ–Ω—Ç: –°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç –≤–∏–∑–∞?
–ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç: –°—Ç–æ–∏–º–æ—Å—Ç—å –≤–∏–∑—ã –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å—Ç—Ä–∞–Ω—ã...
```

CSV:
```csv
role,content
user,–°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç –≤–∏–∑–∞?
assistant,–°—Ç–æ–∏–º–æ—Å—Ç—å –≤–∏–∑—ã –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å—Ç—Ä–∞–Ω—ã...
```

**–§–æ—Ä–º–∞—Ç —Ç–µ–∫—Å—Ç–∞:**
```
–í–∏–∑–∞ –≤ –ò—Ç–∞–ª–∏—é
- –°—Ä–æ–∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è: 60 –¥–Ω–µ–π
- –°—Ç–æ–∏–º–æ—Å—Ç—å: –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∏–ø–∞ –≤–∏–∑—ã
- –î–æ–∫—É–º–µ–Ω—Ç—ã: –∑–∞–≥—Ä–∞–Ω–ø–∞—Å–ø–æ—Ä—Ç, —Ñ–æ—Ç–æ, —Å–ø—Ä–∞–≤–∫–∞ –æ –¥–æ—Ö–æ–¥–∞—Ö

–í–∏–∑–∞ –≤ –°–®–ê
- –°—Ç–æ–∏–º–æ—Å—Ç—å: 50 000 ‚ÇΩ
- –ü–æ–¥–∞—á–∞: —Ç–æ–ª—å–∫–æ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ –∏–ª–∏ –í–∞—Ä—à–∞–≤–µ
```

**–ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ:**
```python
from utils.knowledge_cards import add_knowledge_from_text

count, topics = add_knowledge_from_text(
    text="–í–∏–∑–∞ –≤ –ò—Ç–∞–ª–∏—é\n- –°—Ä–æ–∫: 60 –¥–Ω–µ–π",
    source="admin_manual",
    dialog_id="tg_admin_123"
)
```

## –£–ª—É—á—à–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫

### –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ —Å —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ–º

–ü–æ–∏—Å–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–º–±–∏–Ω–∞—Ü–∏—é –º–µ—Ç–æ–¥–æ–≤:
1. –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –≤ —Ç–µ–º–µ (–≤—ã—Å–æ–∫–∏–π –≤–µ—Å)
2. –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è —Å—Ö–æ–∂–µ—Å—Ç—å —Ç–µ–º—ã
3. –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–æ —Ñ–∞–∫—Ç–∞–º
4. –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–æ —Ç–µ–≥–∞–º
5. –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
6. –ë–æ–Ω—É—Å—ã –∑–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
from utils.knowledge_cards import search_knowledge_cards

results = search_knowledge_cards(
    query="–≤–∏–∑–∞ –≤ –∏—Ç–∞–ª–∏—é",
    limit=10,
    category="–≤–∏–∑—ã_—à–µ–Ω–≥–µ–Ω",  # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
    min_relevance=0.3
)

# results - —Å–ø–∏—Å–æ–∫ –∫–æ—Ä—Ç–µ–∂–µ–π (score, card)
for score, card in results:
    print(f"{card['topic']}: {score:.2f}")
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è:
- `usage_count` - —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ 1
- `last_used_at` - –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞
- `relevance_score` - —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ 0.01 (–º–∞–∫—Å–∏–º—É–º 1.0)

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–∏—Å—Ç–µ–º–µ "—É—á–∏—Ç—å—Å—è" - —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ–ª—É—á–∞—é—Ç –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç.

## –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è –ø—Ä–æ–º–ø—Ç–∞

–ü—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞ —Å–∏—Å—Ç–µ–º–∞:
1. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —É–ª—É—á—à–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ –¥–ª—è –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
2. –ë–µ—Ä–µ—Ç —Ç–æ–ø-3 –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏
3. –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
4. –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –ø—Ä–æ–º–ø—Ç–∞

**–§–æ—Ä–º–∞—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞:**
```
**–í–∏–∑–∞ –≤ –ò—Ç–∞–ª–∏—é**
- –°—Ä–æ–∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è: 60 –¥–Ω–µ–π
- –°—Ç–æ–∏–º–æ—Å—Ç—å: –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∏–ø–∞ –≤–∏–∑—ã
- –î–æ–∫—É–º–µ–Ω—Ç—ã: –∑–∞–≥—Ä–∞–Ω–ø–∞—Å–ø–æ—Ä—Ç, —Ñ–æ—Ç–æ, —Å–ø—Ä–∞–≤–∫–∞ –æ –¥–æ—Ö–æ–¥–∞—Ö

**–í–∏–∑–∞ –≤ –°–®–ê**
- –°—Ç–æ–∏–º–æ—Å—Ç—å: 50 000 ‚ÇΩ
- –ü–æ–¥–∞—á–∞: —Ç–æ–ª—å–∫–æ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ –∏–ª–∏ –í–∞—Ä—à–∞–≤–µ
```

## –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π

`/knowledge` –∏–ª–∏ `/kb` (—Ç–∞–∫–∂–µ `/faq` –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏) ‚Üí "üõ† –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏"

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:**
- üìù –î–æ–±–∞–≤–∏—Ç—å –∑–Ω–∞–Ω–∏—è (—Ç–µ–∫—Å—Ç–æ–º) - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∑–Ω–∞–Ω–∏–π –∏–∑ —Ç–µ–∫—Å—Ç–∞
- üìé –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª —Å –ø–µ—Ä–µ–ø–∏—Å–∫–∞–º–∏ - –∑–∞–≥—Ä—É–∑–∫–∞ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∑–Ω–∞–Ω–∏–π
- üì§ –°–∫–∞—á–∞—Ç—å –±–∞–∑—É –∑–Ω–∞–Ω–∏–π - —Å–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª knowledge_cards.json
- üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å - –ø—Ä–µ–≤—å—é –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
- üõ† –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ - –¥–µ—Ç–∞–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
  - üïí –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–µ–¥–∞–≤–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏
  - üîé –ü–æ–∏—Å–∫ - —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
  - üìÑ –ü–æ–∫–∞–∑–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É –ø–æ —Ç–µ–º–µ - –ø—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
  - ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–∫—Ç - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–∫—Ç–∞ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ç–µ–º–µ
  - üìù –î–æ–±–∞–≤–∏—Ç—å –∑–Ω–∞–Ω–∏—è –∏–∑ —Ç–µ–∫—Å—Ç–∞ - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∑–Ω–∞–Ω–∏–π –∏–∑ —Ç–µ–∫—Å—Ç–∞
  - ü§ñ –ò–∑–≤–ª–µ—á—å –∑–Ω–∞–Ω–∏—è –∏–∑ –ø–µ—Ä–µ–ø–∏—Å–æ–∫ - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤
  - üß© –°–∫–ª–µ–∏—Ç—å —Ç–µ–º—ã - –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–≤—É—Ö —Ç–µ–º
  - üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —Ç–µ–º—É - —É–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏

## API —Ñ—É–Ω–∫—Ü–∏–π

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

#### `load_knowledge_cards() -> List[Dict[str, Any]]`
–ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ knowledge cards.

#### `save_knowledge_cards(cards: List[Dict[str, Any]]) -> None`
–°–æ—Ö—Ä–∞–Ω—è–µ—Ç knowledge cards.

#### `upsert_knowledge_cards(new_cards, dialog_id, source) -> Tuple[int, int]`
–î–æ–±–∞–≤–ª—è–µ—Ç –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∫–∞—Ä—Ç–æ—á–∫–∏. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç (created, updated).

#### `search_knowledge_cards(query, limit, category, min_relevance) -> List[Tuple[float, Dict]]`
–£–ª—É—á—à–µ–Ω–Ω—ã–π —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ —Å —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ–º.

#### `add_knowledge_from_text(text, source, dialog_id) -> Tuple[int, List[str]]`
–ò–∑–≤–ª–µ–∫–∞–µ—Ç –∑–Ω–∞–Ω–∏—è –∏–∑ —Ç–µ–∫—Å—Ç–∞ –∏ —Å–æ–∑–¥–∞–µ—Ç –∫–∞—Ä—Ç–æ—á–∫–∏.

#### `update_usage(card) -> None`
–û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏.

### –§—É–Ω–∫—Ü–∏–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∑–Ω–∞–Ω–∏–π

#### `extract_knowledge_from_dialog(dialog_id, dialogue_history) -> List[Dict]`
–ò–∑–≤–ª–µ–∫–∞–µ—Ç –∑–Ω–∞–Ω–∏—è –∏–∑ –¥–∏–∞–ª–æ–≥–∞ —á–µ—Ä–µ–∑ LLM.

#### `process_dialogs_for_knowledge_extraction(max_dialogs, min_age_minutes) -> Dict`
–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏ –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∑–Ω–∞–Ω–∏—è.

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

1. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** - –∑–Ω–∞–Ω–∏—è –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ –ø–µ—Ä–µ–ø–∏—Å–æ–∫
2. **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å** - —á–µ—Ç–∫–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –∏ —Ç–µ–≥–∞–º
3. **–£–º–Ω—ã–π –ø–æ–∏—Å–∫** - —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ —Å —É—á–µ—Ç–æ–º —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏
4. **–°–∞–º–æ–æ–±—É—á–µ–Ω–∏–µ** - —Å–∏—Å—Ç–µ–º–∞ "—É—á–∏—Ç—Å—è" –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∫–∞—Ä—Ç–æ—á–µ–∫
5. **–ì–∏–±–∫–æ—Å—Ç—å** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä—É—á–Ω–æ–≥–æ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
6. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Ç–µ–≥–∏

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

1. **–†–µ–≥—É–ª—è—Ä–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ** - –∑–∞–ø—É—Å–∫–∞–π—Ç–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∑–Ω–∞–Ω–∏–π –∏–∑ –ø–µ—Ä–µ–ø–∏—Å–æ–∫ —Ä–∞–∑ –≤ –¥–µ–Ω—å/–Ω–µ–¥–µ–ª—é
2. **–†—É—á–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ** - –¥–æ–±–∞–≤–ª—è–π—Ç–µ –≤–∞–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤—Ä—É—á–Ω—É—é –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
3. **–ö–∞—Ç–µ–≥–æ—Ä–∏–∏** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –ª—É—á—à–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
4. **–¢–µ–≥–∏** - –¥–æ–±–∞–≤–ª—è–π—Ç–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ç–µ–≥–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø–æ–∏—Å–∫–∞
5. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

## –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö

–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ knowledge cards –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π. –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏:
- –î–æ–±–∞–≤–ª—è—é—Ç—Å—è –ø–æ–ª—è `category`, `priority`, `relevance_score`, `usage_count` —Å–æ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- –°—Ç–∞—Ä—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ–ª—É—á–∞—é—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é "–æ–±—â–µ–µ" –∏ —Å—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
- –†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ 0.5

